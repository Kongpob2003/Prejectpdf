<div class="home-container">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo logo-box">
      <span class="material-icons logo-icon">picture_as_pdf</span>
      <span class="logo-text">MyPDF</span>
    </div>

    <ul>
      <li><span class="material-icons">home</span>หน้าหลัก</li>
      <li (click)="goProfile()">
        <span class="material-icons">person</span>
        ข้อมูลส่วนตัว
      </li>
      <li (click)="goCalender()">
        <span class="material-icons">calendar_month</span>ปฏิทิน
      </li>
      <li (click)="goAdddelete()">
        <span class="material-icons">group_add</span>เพิ่มลดผู้ใช้
      </li>
      <li (click)="goRelation()">
        <span class="material-icons">campaign</span>ประชาสัมพันธ์
      </li>
      <li (click)="goJae()">
        <span class="material-icons">description</span>JAE
      </li>
      <li (click)="goQualityassurance()">
        <span class="material-icons">verified</span>ประกันคุณภาพ
      </li>
      <li (click)="goCategory()">
        <span class="material-icons">category</span>หมวดหมู่
      </li>
      <li class="logout" (click)="logout()">
        <span class="material-icons">logout</span>ออกจากระบบ
      </li>
    </ul>
  </aside>

  <!-- Success Toast -->
  <div class="success-toast" *ngIf="uploadSuccess">
    ✅ อัปโหลดเอกสารสำเร็จ
  </div>

  <!-- Content -->
  <main class="content">
    <!-- Top bar -->
    <div class="top-bar">
      <div class="search-box">
        <span class="material-icons search-icon">search</span>
        <input
          type="text"
          placeholder="ค้นหาชื่อไฟล์"
          [(ngModel)]="searchText"
        />
      </div>

      <!-- <div class="user-info">
        <span class="user-name">{{ user?.fname || 'ผู้ใช้' }}</span>
        <span class="material-icons">account_circle</span>
      </div> -->
    </div>

    <div class="divider"></div>

    <!-- Summary -->
    <div class="summary-row">
      <div class="summary-box">
        <span class="material-icons summary-icon">description</span>
        <div class="summary-text">
          <p class="summary-number">{{ this.document.length }} ไฟล์</p>
          <h3>เอกสารทั้งหมด</h3>
        </div>
      </div>

      <button class="upload-btn" type="button" (click)="openUpload()">
        อัปโหลดไฟล์
      </button>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button
        type="button"
        [class.active]="activeTab === 'all'"
        (click)="activeTab = 'all'"
      >
        ทั้งหมด
      </button>
      <button
        type="button"
        [class.active]="activeTab === 'sent'"
        (click)="activeTab = 'sent'"
      >
        ส่งแล้ว
      </button>
      <button
        type="button"
        [class.active]="activeTab === 'unsent'"
        (click)="activeTab = 'unsent'"
      >
        ยังไม่ส่ง
      </button>
    </div>

    <!-- Files -->
    <div class="files-box">
      <div class="file-grid">
        <div
          class="file-card"
          *ngFor="let file of filteredFiles"
          (click)="openModal(file)"
        >
          <span
            class="material-icons delete-icon"
            (click)="deleteFile($event, file)"
            >delete</span
          >

          <span class="material-icons file-icon">picture_as_pdf</span>
          <div class="file-name">{{ file.file_name }}</div>

          <span
            class="status-badge"
            [ngClass]="file.statue === '1' ? 'sent' : 'unsent'"
          >
            {{ file.statue === '1' ? 'ส่งแล้ว' : 'ยังไม่ส่ง' }}
          </span>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Preview Modal -->
<div class="modal-backdrop" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-box" (click)="$event.stopPropagation()">
    <h3>{{ selectedFile?.file_name }}</h3>

    <iframe
      class="pdf-preview"
      [src]="selectedFile?.file_url"
      width="100%"
      height="400"
    ></iframe>

    <button class="upload-btn" type="button" (click)="closeModal()">
      ปิด
    </button>
  </div>
</div>

<!-- Upload Popup -->
<div class="upload-backdrop" *ngIf="showUpload" (click)="closeUpload()">
  <div class="upload-modal" (click)="$event.stopPropagation()">
    <h3>อัปโหลดเอกสาร</h3>

    <div class="upload-form">
      <!-- หัวเรื่อง (จะถูกเติมอัตโนมัติจากชื่อไฟล์) -->
      <label>หัวเรื่อง</label>
      <input
        type="text"
        placeholder="กรอกชื่อเอกสาร"
        [(ngModel)]="uploadTitle"
        readonly
      />

      <!-- File upload -->
      <label>ไฟล์ PDF</label>
      <label class="file-upload">
        <span class="material-icons">picture_as_pdf</span>
        <div>คลิกเพื่อเลือกไฟล์</div>

        <input
          type="file"
          accept="application/pdf"
          hidden
          (change)="onFileSelected($event)"
        />

        <div class="file-name-preview" *ngIf="uploadFileName">
          {{ uploadFileName }}
        </div>
      </label>

      <!-- เลือกอาจารย์ -->
      <label class="form-label">เลือกอาจารย์</label>

      <div class="teacher-grid">
        <div
          class="teacher-card"
          *ngFor="let t of teachers"
          (click)="toggleTeacher(t)"
          [class.selected]="selectedTeachers.includes(t)"
        >
          <span class="material-icons">person</span>
          <div>{{ t }}</div>
        </div>
      </div>

      <p class="teacher-count" *ngIf="selectedTeachers.length > 0">
        เลือกแล้ว {{ selectedTeachers.length }} คน
      </p>

      <!-- Actions -->
      <div class="upload-actions">
        <button class="btn-cancel" type="button" (click)="closeUpload()">
          ยกเลิก
        </button>

        <button
          class="btn-submit"
          type="button"
          [disabled]="!uploadFile || selectedTeachers.length === 0"
          (click)="submitUpload()"
        >
          อัปโหลด
        </button>
      </div>
    </div>
  </div>
</div>